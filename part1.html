<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Part 1 - Introduction and Setting up the REPL | Let’s Build a Simple Database</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Part 1 - Introduction and Setting up the REPL" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="As a web developer, I use relational databases every day at my job, but they’re a black box to me. Some questions I have: What format is data saved in? (in memory and on disk) When does it move from memory to disk? Why can there only be one primary key per table? How does rolling back a transaction work? How are indexes formatted? When and how does a full table scan happen? What format is a prepared statement saved in?" />
<meta property="og:description" content="As a web developer, I use relational databases every day at my job, but they’re a black box to me. Some questions I have: What format is data saved in? (in memory and on disk) When does it move from memory to disk? Why can there only be one primary key per table? How does rolling back a transaction work? How are indexes formatted? When and how does a full table scan happen? What format is a prepared statement saved in?" />
<link rel="canonical" href="https://cstack.github.io/db_tutorial/parts/part1.html" />
<meta property="og:url" content="https://cstack.github.io/db_tutorial/parts/part1.html" />
<meta property="og:site_name" content="Let’s Build a Simple Database" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-08-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Part 1 - Introduction and Setting up the REPL" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2017-08-30T00:00:00+00:00","datePublished":"2017-08-30T00:00:00+00:00","description":"As a web developer, I use relational databases every day at my job, but they’re a black box to me. Some questions I have: What format is data saved in? (in memory and on disk) When does it move from memory to disk? Why can there only be one primary key per table? How does rolling back a transaction work? How are indexes formatted? When and how does a full table scan happen? What format is a prepared statement saved in?","headline":"Part 1 - Introduction and Setting up the REPL","mainEntityOfPage":{"@type":"WebPage","@id":"https://cstack.github.io/db_tutorial/parts/part1.html"},"url":"https://cstack.github.io/db_tutorial/parts/part1.html"}</script>
<!-- End Jekyll SEO tag -->


    <link rel="stylesheet" href="/db_tutorial/assets/css/style.css?v=60b50c5b7be787a4aaa1e50ab8a90c6cabb75159">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Let's Build a Simple Database</h1>
        <p>Writing a sqlite clone from scratch in C</p>

        <p class="view"><a href="/db_tutorial/">Overview</a></p>

        
          <p class="view"><a href="https://github.com/cstack/db_tutorial">View on GitHub (pull requests welcome)</a></p>
        

        

        

        <div style="color:#721c24;background-color:#f8d7da;border-color:#f5c6cb;padding:.75rem 1.25rem;border-radius:.25rem;margin-bottom:1rem">
          <p><b>This project is no longer under active development.</b> You can read more <a href="/db_tutorial/parts/part15.html">here</a>. But if you'd like to keep learning how to make your own SQLite clone from scratch, or one of many other projects like Docker, Redis, Git or BitTorrent, try <a href="https://app.codecrafters.io/join?via=cstack"><b>CodeCrafters</b></a>.</p>
        </div>
        <div>
          <a href="https://app.codecrafters.io/join?via=cstack"><img src="https://cstack.github.io/db_tutorial/assets/images/code-crafters.jpeg" alt=""/></a>
        </div>
      </header>
      <section>

      
      

      <h1>Part 1 - Introduction and Setting up the REPL</h1>
      
      
          <p><a class="next" href="/db_tutorial/parts/part2.html">Part 2 - World's Simplest SQL Compiler and Virtual Machine</a> <br></p>
      

      <p>As a web developer, I use relational databases every day at my job, but they’re a black box to me. Some questions I have:</p>
<ul>
  <li>What format is data saved in? (in memory and on disk)</li>
  <li>When does it move from memory to disk?</li>
  <li>Why can there only be one primary key per table?</li>
  <li>How does rolling back a transaction work?</li>
  <li>How are indexes formatted?</li>
  <li>When and how does a full table scan happen?</li>
  <li>What format is a prepared statement saved in?</li>
</ul>

<p>In other words, how does a database <strong>work</strong>?</p>

<p>To figure things out, I’m writing a database from scratch. It’s modeled off sqlite because it is designed to be small with fewer features than MySQL or PostgreSQL, so I have a better hope of understanding it. The entire database is stored in a single file!</p>

<h1 id="sqlite">Sqlite</h1>

<p>There’s lots of <a href="https://www.sqlite.org/arch.html">documentation of sqlite internals</a> on their website, plus I’ve got a copy of <a href="https://play.google.com/store/books/details?id=9Z6IQQnX1JEC">SQLite Database System: Design and Implementation</a>.</p>

<table class="image">
<caption align="bottom">sqlite architecture (https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki)</caption>
<tr><td><a href="https://cstack.github.io/db_tutorial/assets/images/arch1.gif"><img src="https://cstack.github.io/db_tutorial/assets/images/arch1.gif" alt="sqlite architecture (https://www.sqlite.org/zipvfs/doc/trunk/www/howitworks.wiki)" /></a></td></tr>
</table>

<p>A query goes through a chain of components in order to retrieve or modify data. The <strong>front-end</strong> consists of the:</p>
<ul>
  <li>tokenizer</li>
  <li>parser</li>
  <li>code generator</li>
</ul>

<p>The input to the front-end is a SQL query. the output is sqlite virtual machine bytecode (essentially a compiled program that can operate on the database).</p>

<p>The <em>back-end</em> consists of the:</p>
<ul>
  <li>virtual machine</li>
  <li>B-tree</li>
  <li>pager</li>
  <li>os interface</li>
</ul>

<p>The <strong>virtual machine</strong> takes bytecode generated by the front-end as instructions. It can then perform operations on one or more tables or indexes, each of which is stored in a data structure called a B-tree. The VM is essentially a big switch statement on the type of bytecode instruction.</p>

<p>Each <strong>B-tree</strong> consists of many nodes. Each node is one page in length. The B-tree can retrieve a page from disk or save it back to disk by issuing commands to the pager.</p>

<p>The <strong>pager</strong> receives commands to read or write pages of data. It is responsible for reading/writing at appropriate offsets in the database file. It also keeps a cache of recently-accessed pages in memory, and determines when those pages need to be written back to disk.</p>

<p>The <strong>os interface</strong> is the layer that differs depending on which operating system sqlite was compiled for. In this tutorial, I’m not going to support multiple platforms.</p>

<p><a href="https://en.wiktionary.org/wiki/a_journey_of_a_thousand_miles_begins_with_a_single_step">A journey of a thousand miles begins with a single step</a>, so let’s start with something a little more straightforward: the REPL.</p>

<h2 id="making-a-simple-repl">Making a Simple REPL</h2>

<p>Sqlite starts a read-execute-print loop when you start it from the command line:</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ sqlite3
SQLite version 3.16.0 2016-11-04 19:09:39
Enter <span class="s2">".help"</span> <span class="k">for </span>usage hints.
Connected to a transient <span class="k">in</span><span class="nt">-memory</span> database.
Use <span class="s2">".open FILENAME"</span> to reopen on a persistent database.
sqlite&gt; create table <span class="nb">users</span> <span class="o">(</span><span class="nb">id </span>int, username varchar<span class="o">(</span>255<span class="o">)</span>, email varchar<span class="o">(</span>255<span class="o">))</span><span class="p">;</span>
sqlite&gt; .tables
<span class="nb">users
</span>sqlite&gt; .exit
~
</code></pre></div></div>

<p>To do that, our main function will have an infinite loop that prints the prompt, gets a line of input, then processes that line of input:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span> <span class="o">=</span> <span class="n">new_input_buffer</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print_prompt</span><span class="p">();</span>
    <span class="n">read_input</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="s">".exit"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">close_input_buffer</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Unrecognized command '%s'.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>We’ll define <code class="language-plaintext highlighter-rouge">InputBuffer</code> as a small wrapper around the state we need to store to interact with <a href="http://man7.org/linux/man-pages/man3/getline.3.html">getline()</a>. (More on that in a minute)</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">buffer_length</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">input_length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">InputBuffer</span><span class="p">;</span>

<span class="n">InputBuffer</span><span class="o">*</span> <span class="nf">new_input_buffer</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">InputBuffer</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">InputBuffer</span><span class="p">));</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">input_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">input_buffer</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Next, <code class="language-plaintext highlighter-rouge">print_prompt()</code> prints a prompt to the user. We do this before reading each line of input.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">print_prompt</span><span class="p">()</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"db &gt; "</span><span class="p">);</span> <span class="p">}</span>
</code></pre></div></div>

<p>To read a line of input, use <a href="http://man7.org/linux/man-pages/man3/getline.3.html">getline()</a>:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">ssize_t</span> <span class="nf">getline</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">lineptr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">);</span>
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">lineptr</code> : a pointer to the variable we use to point to the buffer containing the read line. If it set to <code class="language-plaintext highlighter-rouge">NULL</code> it is mallocatted by <code class="language-plaintext highlighter-rouge">getline</code> and should thus be freed by the user, even if the command fails.</p>

<p><code class="language-plaintext highlighter-rouge">n</code> : a pointer to the variable we use to save the size of allocated buffer.</p>

<p><code class="language-plaintext highlighter-rouge">stream</code> : the input stream to read from. We’ll be reading from standard input.</p>

<p><code class="language-plaintext highlighter-rouge">return value</code> : the number of bytes read, which may be less than the size of the buffer.</p>

<p>We tell <code class="language-plaintext highlighter-rouge">getline</code> to store the read line in <code class="language-plaintext highlighter-rouge">input_buffer-&gt;buffer</code> and the size of the allocated buffer in <code class="language-plaintext highlighter-rouge">input_buffer-&gt;buffer_length</code>. We store the return value in <code class="language-plaintext highlighter-rouge">input_buffer-&gt;input_length</code>.</p>

<p><code class="language-plaintext highlighter-rouge">buffer</code> starts as null, so <code class="language-plaintext highlighter-rouge">getline</code> allocates enough memory to hold the line of input and makes <code class="language-plaintext highlighter-rouge">buffer</code> point to it.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">read_input</span><span class="p">(</span><span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">ssize_t</span> <span class="n">bytes_read</span> <span class="o">=</span>
      <span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer_length</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">bytes_read</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Error reading input</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Ignore trailing newline</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">input_length</span> <span class="o">=</span> <span class="n">bytes_read</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">bytes_read</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now it is proper to define a function that frees the memory allocated for an
instance of <code class="language-plaintext highlighter-rouge">InputBuffer *</code> and the <code class="language-plaintext highlighter-rouge">buffer</code> element of the respective
structure (<code class="language-plaintext highlighter-rouge">getline</code> allocates memory for <code class="language-plaintext highlighter-rouge">input_buffer-&gt;buffer</code> in
<code class="language-plaintext highlighter-rouge">read_input</code>).</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">close_input_buffer</span><span class="p">(</span><span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">free</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Finally, we parse and execute the command. There is only one recognized command right now : <code class="language-plaintext highlighter-rouge">.exit</code>, which terminates the program. Otherwise we print an error message and continue the loop.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="s">".exit"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">close_input_buffer</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
  <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Unrecognized command '%s'.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Let’s try it out!</p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ ./db
db <span class="o">&gt;</span> .tables
Unrecognized <span class="nb">command</span> <span class="s1">'.tables'</span><span class="nb">.</span>
db <span class="o">&gt;</span> .exit
~
</code></pre></div></div>

<p>Alright, we’ve got a working REPL. In the next part, we’ll start developing our command language. Meanwhile, here’s the entire program from this part:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdbool.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp">
</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span><span class="o">*</span> <span class="n">buffer</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">buffer_length</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">input_length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">InputBuffer</span><span class="p">;</span>

<span class="n">InputBuffer</span><span class="o">*</span> <span class="nf">new_input_buffer</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">InputBuffer</span><span class="p">));</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">input_length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">input_buffer</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">print_prompt</span><span class="p">()</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"db &gt; "</span><span class="p">);</span> <span class="p">}</span>

<span class="kt">void</span> <span class="nf">read_input</span><span class="p">(</span><span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span><span class="p">)</span> <span class="p">{</span>
  <span class="kt">ssize_t</span> <span class="n">bytes_read</span> <span class="o">=</span>
      <span class="n">getline</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">),</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer_length</span><span class="p">),</span> <span class="n">stdin</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">bytes_read</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"Error reading input</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Ignore trailing newline</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">input_length</span> <span class="o">=</span> <span class="n">bytes_read</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">[</span><span class="n">bytes_read</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">close_input_buffer</span><span class="p">(</span><span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">free</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">argv</span><span class="p">[])</span> <span class="p">{</span>
  <span class="n">InputBuffer</span><span class="o">*</span> <span class="n">input_buffer</span> <span class="o">=</span> <span class="n">new_input_buffer</span><span class="p">();</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">print_prompt</span><span class="p">();</span>
    <span class="n">read_input</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">,</span> <span class="s">".exit"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">close_input_buffer</span><span class="p">(</span><span class="n">input_buffer</span><span class="p">);</span>
      <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_SUCCESS</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Unrecognized command '%s'.</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">input_buffer</span><span class="o">-&gt;</span><span class="n">buffer</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>


      
      
          <p><a class="next" href="/db_tutorial/parts/part2.html">Part 2 - World's Simplest SQL Compiler and Virtual Machine</a> <br></p>
      

      </section>
      <footer>
        
        <p><a href="/db_tutorial/feed.xml">rss</a> | <a href="https://ifttt.com/applets/60708433d-rss-feed-to-email">subscribe by email</a></p>
        <p>This project is maintained by <a href="https://github.com/cstack">cstack</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="/db_tutorial/assets/js/scale.fix.js"></script>


  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-105767942-1', 'auto');
        ga('send', 'pageview');
    </script>
  
  </body>
</html>
